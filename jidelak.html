y<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jídelníček</title>
<style>
/* Stejný styl jako předtím */
body { font-family: Arial; margin: 0; padding: 0; background: #f5f5f5; }
.container { max-width: 500px; margin: 50px auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
button { padding: 10px 20px; margin-top: 10px; cursor: pointer; border: none; border-radius: 5px; background: #4285F4; color: #fff; }
input, select { width: 100%; padding: 8px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; }
.card { background: #e8f0fe; padding: 10px; margin: 10px 0; border-radius: 5px; }
</style>
</head>
<body>
<div class="container" id="authDiv">
<h2>Přihlášení</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Heslo">
<button id="loginBtn">Přihlásit se / Registrovat</button>
</div>

<div class="container" id="profileDiv" style="display:none;">
<h2>Profil</h2>
<select id="role">
<option value="">Vyber roli</option>
<option value="kuchar">Kuchař</option>
<option value="viver">Viver</option>
</select>
<input type="number" id="vek" placeholder="Věk">
<select id="pohlavi">
<option value="">Pohlaví</option>
<option value="muz">Chlapec</option>
<option value="zena">Dívka</option>
</select>
<button id="saveProfileBtn">Uložit profil</button>
</div>

<div class="container" id="menuDiv" style="display:none;">
<h2>Jídelníček</h2>
<div id="menuList"></div>
<input type="text" id="newItem" placeholder="Přidej jídlo" style="display:none;">
<button id="addItemBtn" style="display:none;">Přidat</button>
<button id="logoutBtn">Odhlásit se</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
import { getFirestore, collection, doc, getDoc, setDoc, addDoc, serverTimestamp, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyD5-2QubsqTsbGEyao8hcYZKg2BEo21dDI",
  authDomain: "jidelnicek-e285d.firebaseapp.com",
  projectId: "jidelnicek-e285d",
  storageBucket: "jidelnicek-e285d.firebasestorage.app",
  messagingSenderId: "951150330349",
  appId: "1:951150330349:web:1cb894b80e0df2a6b5e7e4",
  measurementId: "G-LQ9E89K95N"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Elements
const authDiv = document.getElementById("authDiv");
const profileDiv = document.getElementById("profileDiv");
const menuDiv = document.getElementById("menuDiv");
const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const saveProfileBtn = document.getElementById("saveProfileBtn");
const roleSelect = document.getElementById("role");
const vekInput = document.getElementById("vek");
const pohlaviSelect = document.getElementById("pohlavi");
const menuList = document.getElementById("menuList");
const newItemInput = document.getElementById("newItem");
const addItemBtn = document.getElementById("addItemBtn");
const logoutBtn = document.getElementById("logoutBtn");

let currentUser = null;
let currentRole = "";

// Login/Register
loginBtn.onclick = async () => {
    const email = emailInput.value;
    const password = passwordInput.value;
    if(!email || !password) return alert("Vyplň email i heslo");
    try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        initUser(userCredential.user);
    } catch(err) {
        if(err.code === "auth/user-not-found") {
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                initUser(userCredential.user);
            } catch(e) { alert(e.message); }
        } else alert(err.message);
    }
}

// Init user
async function initUser(user){
    currentUser = user;
    const docRef = doc(db, "users", user.uid);
    const docSnap = await getDoc(docRef);
    if(docSnap.exists() && docSnap.data().role){
        currentRole = docSnap.data().role;
        showMenu();
    } else {
        authDiv.style.display = "none";
        profileDiv.style.display = "block";
    }
}

// Save profile
saveProfileBtn.onclick = async () => {
    const role = roleSelect.value;
    const vek = vekInput.value;
    const pohlavi = pohlaviSelect.value;
    if(!role || !vek || !pohlavi) return alert("Vyplň vše");
    await setDoc(doc(db, "users", currentUser.uid), {role, vek, pohlavi});
    currentRole = role;
    showMenu();
}

// Show menu
function showMenu(){
    authDiv.style.display = "none";
    profileDiv.style.display = "none";
    menuDiv.style.display = "block";
    if(currentRole === "kuchar"){
        newItemInput.style.display = "block";
        addItemBtn.style.display = "block";
    }

    const q = query(collection(db,"menu"), orderBy("timestamp"));
    onSnapshot(q, (snapshot)=>{
        menuList.innerHTML = "";
        snapshot.forEach(doc => {
            const div = document.createElement("div");
            div.className = "card";
            div.textContent = doc.data().item;
            menuList.appendChild(div);
        });
    });
}

// Add item
addItemBtn.onclick = async () => {
    const item = newItemInput.value.trim();
    if(!item) return;
    await addDoc(collection(db,"menu"), {item, timestamp: serverTimestamp()});
    newItemInput.value = "";
}

// Logout
logoutBtn.onclick = () => signOut(auth).then(()=>location.reload());

</script>
</body>
</html>
